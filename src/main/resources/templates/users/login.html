<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<!-- 導覽列 -->
<div th:replace="~{fragments/navbar.html :: navbar}"></div>

<!-- page content -->
<div class="container mt-5 pt-5">
    <div class="center-form-container">
        <h2 class="mb-4">登入頁面</h2>
        <form id="loginForm" onsubmit="handleLogin(event)">
            <label for="email" class="form-label">電子郵件：</label>
            <input type="email" class="form-control" id="email" name="email" required>
            <br>
            <label for="password" class="form-label">密碼：</label>
            <input type="password" class="form-control" id="password" name="password" required>
            <br>
            <button type="submit" class="btn btn-primary">登入</button>
        </form>
    </div>
</div>
<script>
    function handleLogin(event) {
        event.preventDefault();  // 阻止表單的默認提交

        var username = document.getElementById("email").value;
        var password = document.getElementById("password").value;

        var loginData = {
            "email": username,
            "password": password
        };

        // 使用 Fetch API 來發送 POST 請求
        fetch("/api/users/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: 'include',
            body: JSON.stringify(loginData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || "登入失敗，請檢查帳號或密碼")
                    })
                }
                return response.json(); // 提取錯誤訊息
            })
            .then(user => {
                if (user.role === 1) {
                    window.location.href = "/managers/book_manager"
                } else {
                    window.location.href = "/index";
                }
            })
            .catch(error => {
                console.error("錯誤:", error);
                alert(error.message);
            });
    }
</script>
</body>
</html>